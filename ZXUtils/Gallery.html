<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class ZXUtils::Gallery - ruby-Z80</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/navigation.js" defer></script>
<script src="../js/search.js" defer></script>
<script src="../js/search_index.js" defer></script>
<script src="../js/searcher.js" defer></script>
<script src="../js/darkfish.js" defer></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">




<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="../Object.html">Object</a>
  
</div>

    <div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
  
  
    <li><a class="include" href="../Z80.html">Z80</a>
  
  
  
    <li><a class="include" href="Gallery/Formats.html">ZXUtils::Gallery::Formats</a>
  
  
  </ul>
</div>

    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-start">#start</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-ZXUtils::Gallery">
  <h1 id="class-ZXUtils::Gallery" class="class">
    class ZXUtils::Gallery
  </h1>

  <section class="description">
    
<h1 id="class-ZXUtils::Gallery-label-ZXUtils-3A-3AGallery."><a href="Gallery.html"><code>ZXUtils::Gallery</code></a>.<span><a href="#class-ZXUtils::Gallery-label-ZXUtils-3A-3AGallery.">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>A program to load from tape and display various ZX Spectrum screen formats.</p>

<p>Supported ULAplus formats:</p>

<pre>     format type      size      mode      colors   palette
/------------------^-------^------------^--------^---------\
| standard screen  |  6912 | screen 0   |     15 | default |
| standard plus    |  6976 | screen 0   |     64 | static  |
| standard HAM256  |  7680 | screen 0   |    256 | dynamic |
| high color       | 12288 | hi-color   |     15 | default |
| high resolution  | 12289 | hi-res     |      2 | bright  |
| hi-color plus    | 12352 | hi-color   |     64 | static  |
| hi-res plus      | 12353 | hi-res     |      2 | static  |
| hi-color HAM256  | 13056 | hi-color   |    256 | dynamic |
| stand. interlace | 13824 | screen 0/1 |     15 | default |
\------------------+-------+------------+------------------/</pre>

<p>See: <a href="https://faqwiki.zxnet.co.uk/wiki/ULAplus#Extension_to_the_SCR_format">faqwiki.zxnet.co.uk/wiki/ULAplus#Extension_to_the_SCR_format</a></p>

<p>This gem provides a tool <strong>zxgallery</strong> that can be used to create a gallery .TAP file from .SCR files.</p>

<p>Example:</p>

<p>The following will produce <strong>test_gallery.tap</strong> file with the program and the .SCR files as TAP bytes.</p>

<pre>zxgallery *.scr -o test_gallery.tap</pre>

<p>This program can be also used as a library.</p>

<p>Example:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;zxlib/basic&#39;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;zxutils/gallery&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">GalleryProg</span>
  <span class="ruby-identifier">include</span> <span class="ruby-constant">Z80</span>
  <span class="ruby-identifier">include</span> <span class="ruby-constant">Z80</span><span class="ruby-operator">::</span><span class="ruby-constant">TAP</span>

  <span class="ruby-identifier">import</span>              <span class="ruby-constant">ZXUtils</span><span class="ruby-operator">::</span><span class="ruby-constant">Gallery</span>
  <span class="ruby-identifier">screen</span>              <span class="ruby-identifier">import_file</span> <span class="ruby-string">&quot;some_screen.scr&quot;</span>
  <span class="ruby-identifier">screen_end</span>          <span class="ruby-identifier">label</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">program_code</span> = <span class="ruby-constant">GalleryProg</span>.<span class="ruby-identifier">new</span> <span class="ruby-value">0xC000</span>
<span class="ruby-identifier">start</span> = <span class="ruby-identifier">program_code</span>[<span class="ruby-value">:start</span>]
<span class="ruby-identifier">screen</span> = <span class="ruby-identifier">program_code</span>[<span class="ruby-value">:screen</span>]
<span class="ruby-identifier">screen_end</span> = <span class="ruby-identifier">program_code</span>[<span class="ruby-value">:screen_end</span>]
<span class="ruby-identifier">program</span> = <span class="ruby-constant">ZXLib</span><span class="ruby-operator">::</span><span class="ruby-constant">Basic</span>.<span class="ruby-identifier">parse_source</span> <span class="ruby-identifier">&lt;&lt;-EOB</span>
<span class="ruby-value">   1 DEF FN d(a,s)=USR #{start}: DEF FN l(a)=USR #{start}: DEF FN x()=USR #{start}
  20 BORDER 0: PAPER 0: INK 7: CLS
  30 RANDOMIZE FN d(#{screen},#{screen_end - screen})
  99 BORDER 7: PAPER 7: INK 0: CLS
9998 STOP: GO TO 10
9999 CLEAR #{0x6000 - 1}: LOAD &quot;&quot;CODE : PRINT USR #{start}: RUN
</span><span class="ruby-identifier">EOB</span>
<span class="ruby-identifier">program</span>.<span class="ruby-identifier">save_tap</span>(<span class="ruby-string">&quot;gallery&quot;</span>, <span class="ruby-value">line:</span> <span class="ruby-value">9999</span>)
<span class="ruby-identifier">program_code</span>.<span class="ruby-identifier">save_tap</span>(<span class="ruby-string">&quot;gallery&quot;</span>, <span class="ruby-value">append:</span> <span class="ruby-keyword">true</span>)
</pre>

  </section>

  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="SCR_MAX_SIZE">SCR_MAX_SIZE
        
        <dd><p>The size of the largest .SCR file format supported.</p>
        
      
      </dl>
    </section>
    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-start" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            USR start
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            DEF FN x()=USR start
          </span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            DEF FN l(a)=USR start
          </span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            DEF FN d(a,s)=USR start
          </span>
          
        </div>
        
        

        <div class="method-description">
          
          <p><a href="Gallery.html"><code>Gallery</code></a> API.</p>

<p>This endpoint should be invoked from the ZX Basic directly via USR or indirectly via FN.</p>

<pre>REM checks for hardware version: 48k or 128k and sets up appropriate delays for HAM256
LET detected=USR start: REM returns 48, 128 or 0 if could not determine

REM sets screen mode to 0, resets palette mode, clears screen attributes
RANDOMIZE FN x()

REM loads the file from the tape and returns its size
LET size=FN l(address): REM provide an address to load the screen at

REM displays the screen
RANDOMIZE FN d(address,size): REM provide an address of the screen and its size</pre>
          
          

          
          <div class="method-source-code" id="start-source">
            <pre><span class="ruby-comment"># File lib/zxutils/gallery.rb, line 130</span>
<span class="ruby-identifier">ns</span> <span class="ruby-value">:start</span> <span class="ruby-keyword">do</span>
                    <span class="ruby-identifier">call</span>  <span class="ruby-identifier">find_def_fn_arg</span>            <span class="ruby-comment"># is this an FN call with arguments?</span>
                    <span class="ruby-identifier">jr</span>    <span class="ruby-constant">C</span>, <span class="ruby-identifier">hw_detect_and_setup</span>     <span class="ruby-comment"># called directly via USR</span>
                    <span class="ruby-identifier">jr</span>    <span class="ruby-constant">NZ</span>, <span class="ruby-identifier">clear</span>                  <span class="ruby-comment"># called via FN ()</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

