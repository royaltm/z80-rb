<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Z80::Label - ruby-Z80</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/navigation.js" defer></script>
<script src="../js/search.js" defer></script>
<script src="../js/search_index.js" defer></script>
<script src="../js/searcher.js" defer></script>
<script src="../js/darkfish.js" defer></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#class-Z80::Label-label-Z80+Label">Z80 Label</a>
    <li><a href="#class-Z80::Label-label-Label+names">Label names</a>
  </ul>
</div>


  <div id="class-metadata">
    
    
<div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  <p class="link"><a href="../Object.html">Object</a>
</div>

    
    
    
<!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    <li ><a href="#method-c-2B-40">::+@</a>
    <li ><a href="#method-c-byte">::byte</a>
    <li ><a href="#method-c-dummy">::dummy</a>
    <li ><a href="#method-c-members_of_struct">::members_of_struct</a>
    <li class="calls-super" ><a href="#method-c-method_missing">::method_missing</a>
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    <li ><a href="#method-c-offset_of_">::offset_of_</a>
    <li ><a href="#method-c-to_data">::to_data</a>
    <li ><a href="#method-c-to_i">::to_i</a>
    <li ><a href="#method-c-to_struct">::to_struct</a>
    <li ><a href="#method-c-word">::word</a>
    <li ><a href="#method-i-25">#%</a>
    <li ><a href="#method-i-26">#&amp;</a>
    <li ><a href="#method-i-2A">#*</a>
    <li ><a href="#method-i-2A-2A">#**</a>
    <li ><a href="#method-i-2B">#+</a>
    <li ><a href="#method-i-2B-40">#+@</a>
    <li ><a href="#method-i-2D">#-</a>
    <li ><a href="#method-i-2D-40">#-@</a>
    <li ><a href="#method-i-2F">#/</a>
    <li ><a href="#method-i-3C-3C">#&lt;&lt;</a>
    <li ><a href="#method-i-3E-3E">#&gt;&gt;</a>
    <li ><a href="#method-i-5B-5D">#[]</a>
    <li ><a href="#method-i-5E">#^</a>
    <li ><a href="#method-i-alias-3F">#alias?</a>
    <li ><a href="#method-i-dummy-3F">#dummy?</a>
    <li ><a href="#method-i-expression-3F">#expression?</a>
    <li ><a href="#method-i-immediate-3F">#immediate?</a>
    <li ><a href="#method-i-indexable-3F">#indexable?</a>
    <li ><a href="#method-i-initialize">#initialize</a>
    <li class="calls-super" ><a href="#method-i-method_missing">#method_missing</a>
    <li ><a href="#method-i-name-3D">#name=</a>
    <li ><a href="#method-i-pointer-3F">#pointer?</a>
    <li ><a href="#method-i-sublabel-3F">#sublabel?</a>
    <li ><a href="#method-i-sublabel_access_expression-3F">#sublabel_access_expression?</a>
    <li ><a href="#method-i-to_aliased_name">#to_aliased_name</a>
    <li ><a href="#method-i-to_alloc">#to_alloc</a>
    <li ><a href="#method-i-to_i">#to_i</a>
    <li ><a href="#method-i-to_label">#to_label</a>
    <li ><a href="#method-i-to_name">#to_name</a>
    <li ><a href="#method-i-to_s">#to_s</a>
    <li ><a href="#method-i-to_str">#to_str</a>
    <li ><a href="#method-i-7C">#|</a>
    <li ><a href="#method-i-~">#~</a>
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Z80::Label">
  <h1 id="class-Z80::Label" class="class">
    class Z80::Label
  </h1>

  <section class="description">
    
<h1 id="class-Z80::Label-label-Z80+Label"><a href="../Z80.html"><code>Z80</code></a> <a href="Label.html"><code>Label</code></a><span><a href="#class-Z80::Label-label-Z80+Label">&para;</a> <a href="#top">&uarr;</a></span></h1>

<pre class="ruby"><span class="ruby-identifier">myloop</span>  <span class="ruby-identifier">inc</span> [<span class="ruby-identifier">hl</span>]
        <span class="ruby-identifier">inc</span> <span class="ruby-identifier">hl</span>
        <span class="ruby-identifier">djnz</span> <span class="ruby-identifier">myloop</span>
</pre>

<p>A label in a <a href="Program.html"><code>Z80::Program</code></a> represents an address, a number, an expression or an index to another label. Instead of using numbers, provide a name and define its value above or below. Labels have three properties assotiated with them: an <code>address</code>, a <code>type</code> (which influences its size) and the property indicating if the label is absolute or relative to the code or a field of a structure.</p>

<p>Labels are being lazy evaluated when a program is being compiled. Labels as well as integers may be used in expressions. Currently there are lazy evaluated expression functions available:</p>

<pre>-x      - a negative x
x + y   - a result of y added to x
x - y   - a result of y subtracted from x
x * y   - a result of x times y
x / y   - a quotient of an euclidean division of x by y
x % y   - a remainder of an euclidean division of x by y
x &lt;&lt; y  - a bitwise left shifted x by y bits
x &gt;&gt; y  - a bitwise right shifted x by y bits
~x      - a bitwise negated x
x ^ y   - a bitwise &quot;exclusive or&quot; of x and y
x | y   - a bitwise &quot;or&quot; of x and y
x &amp; y   - a bitwise &quot;and&quot; of x and y
+z      - a byte size of a type of z (in this instance z must not be an expression)</pre>

<p>Where <code>x</code> and <code>y</code> represents labels or indexes to labels or expressions; <code>y</code> may also be an integer; <code>z</code> may only be a label or an index.</p>

<p>Labels may be nested, that is each label may contain named members. There are two types of such members:</p>
<ul><li>
<p>Independent labels, living in a namespace, formed as a result of using: <a href="Program.html#method-i-import"><code>Program.import</code></a> or <a href="Program.html#method-i-ns"><code>Program.ns</code></a>.</p>
</li><li>
<p>Fields of a data structure; fields represents offsets relative to a parent label; fields may also contain members, but only as fields.</p>
</li></ul>

<p>Members are being accessed by indexes. An index is being formed by either:</p>
<ul><li>
<p>using [index] after a label name, see: <a href="Label.html#method-i-5B-5D"><code>Label#[]</code></a>, e.g.: <code>foo[:bar][2][&#39;baz&#39;]</code></p>
</li><li>
<p>using an undefined method on a label, e.g.: <code>foo.bar[2].baz</code></p>
</li></ul>

<p>Indices as integers or expressions offset labels&#39; addresses by their type&#39;s size. Indices as names access members or sub-labels.</p>

<p>A data structure is a ruby class inherited from <a href="Label.html"><code>Label</code></a>.</p>

<pre class="ruby"><span class="ruby-comment"># a data structure, also a new type: Sprite</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">Sprite</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Label</span>
<span class="ruby-comment"># name    type[, count]</span>
  <span class="ruby-identifier">x</span>       <span class="ruby-identifier">byte</span>, <span class="ruby-value">1</span>
  <span class="ruby-identifier">y</span>       <span class="ruby-identifier">byte</span> <span class="ruby-comment"># , 1 is default</span>
  <span class="ruby-identifier">data_pl</span> <span class="ruby-identifier">byte</span>
  <span class="ruby-identifier">data_ph</span> <span class="ruby-identifier">byte</span>
  <span class="ruby-identifier">size</span>    <span class="ruby-identifier">word</span>
<span class="ruby-comment"># alias   orig.   type</span>
  <span class="ruby-identifier">data_p</span>  <span class="ruby-identifier">data_pl</span> <span class="ruby-identifier">word</span>
<span class="ruby-keyword">end</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">SpritePool</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Label</span>
  <span class="ruby-identifier">numspr</span>  <span class="ruby-identifier">byte</span>
  <span class="ruby-identifier">sprites</span> <span class="ruby-constant">Sprite</span>, <span class="ruby-value">2</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Fields are being formed by labeling data types and providing its count as a second, optional argument. The only basic data types are: <a href="Label.html#method-c-byte"><code>Label.byte</code></a> and <a href="Label.html#method-c-word"><code>Label.word</code></a>. A data structure may also be used as a data type. In the above example <code>data_p</code> and <code>data_pl</code> are aliases (unions) which means that <code>data_p</code> represents the same offset as <code>data_pl</code> but has different size.</p>

<p>Labels that are not part of a structure may be absolute or relative to the program code.  Absolute labels resolve always to the same value so they are also called “immediate” as we don&#39;t need to know the program origin to evaluate them. See <a href="Program.html#method-i-immediate-3F"><code>Program.immediate?</code></a>.</p>
<dl class="rdoc-list note-list"><dt>Note
<dd>
<p>Labels are being evaluated by calling <a href="Label.html#method-i-to_i"><code>Label#to_i</code></a> method on them. Normally you don&#39;t need to know this, but in some corner cases you may want to take advantage of that. However be warned that labels are lazy by its nature and may be defined in the future. Labels that are part of an expression but are not defined yet are called “dummy”. See: <a href="Label.html#method-i-dummy-3F"><code>Label.dummy?</code></a>. Calling <code>to_i</code> on a “dummy” label results in an error. An expression containing at least one “dummy” label is also a “dummy” one.</p>
</dd></dl>

<p>Allocating, that is assigning values to labels may be done in several ways:</p>
<ul><li><dl class="rdoc-list note-list"><dt>With <a href="Program.html#method-i-addr"><code>Program.addr</code></a>
<dd>
<p>Creates an absolute (immediate) label “spritep”, with <code>value</code> = <code>0x8888</code> and of type <code>SpritePool</code>:</p>

<pre class="ruby"><span class="ruby-identifier">spritep</span>   <span class="ruby-identifier">addr</span> <span class="ruby-value">0x8888</span>, <span class="ruby-constant">SpritePool</span>
</pre>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt>With <a href="Program.html#method-i-data"><code>Program.data</code></a>
<dd>
<p>Creates a relative label “spritep”, with <code>value</code> = <a href="Program.html#method-i-pc"><code>Program.pc</code></a> and of type <code>SpritePool</code>, fills SpritePool fields with provided data:</p>

<pre class="ruby"><span class="ruby-identifier">spritep</span>   <span class="ruby-identifier">data</span> <span class="ruby-constant">SpritePool</span>, [<span class="ruby-value">2</span>,
              {<span class="ruby-value">x:</span><span class="ruby-value">0</span>, <span class="ruby-value">y:</span><span class="ruby-value">0</span>, <span class="ruby-value">size:</span><span class="ruby-value">12</span>, <span class="ruby-value">data_p:</span> <span class="ruby-identifier">sprite1_data</span>},
              {<span class="ruby-value">x:</span><span class="ruby-value">0</span>, <span class="ruby-value">y:</span><span class="ruby-value">0</span>, <span class="ruby-value">size:</span><span class="ruby-value">16</span>, <span class="ruby-value">data_p:</span> <span class="ruby-identifier">sprite2_data</span>}]
</pre>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt>With <a href="Program.html#method-i-label"><code>Program.label</code></a>
<dd>
<p>Creates a relative label “someprc”, with <code>value</code> = <a href="Program.html#method-i-pc"><code>Program.pc</code></a> and of type 1:</p>

<pre class="ruby"><span class="ruby-identifier">someprc</span>   <span class="ruby-identifier">label</span>
</pre>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt>With a mnemonic
<dd>
<p>Creates a relative label “someprc”, with <code>value</code> = <a href="Program.html#method-i-pc"><code>Program.pc</code></a> and of type 1:</p>

<pre class="ruby"><span class="ruby-identifier">someprc</span>   <span class="ruby-identifier">ld</span>  <span class="ruby-identifier">de</span>, [<span class="ruby-identifier">foo</span>.<span class="ruby-identifier">bar</span>]
</pre>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt>With <a href="Program.html#method-i-union"><code>Program.union</code></a>
<dd>
<p>Creates a relative label “foo”, with <code>value</code> = <code>bar</code> and of type 2:</p>

<pre class="ruby"><span class="ruby-identifier">foo</span>       <span class="ruby-identifier">union</span> <span class="ruby-identifier">bar</span>, <span class="ruby-value">2</span>
</pre>
</dd></dl>
</li></ul>

<p>Using <a href="Program.html#method-i-alias_label"><code>Program.alias_label</code></a> you can anchor labels:</p>

<pre class="ruby"><span class="ruby-identifier">ns</span> <span class="ruby-value">:inner</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># inner.foo will reference some.other.label</span>
  <span class="ruby-identifier">foo</span>    <span class="ruby-identifier">as</span>  <span class="ruby-identifier">some</span>.<span class="ruby-identifier">other</span>.<span class="ruby-identifier">label</span>
  <span class="ruby-comment"># inner.bar will reference (baz * 3) aligned to 16 bytes.</span>
  <span class="ruby-identifier">bar</span>    <span class="ruby-identifier">as</span>  <span class="ruby-identifier">baz</span> <span class="ruby-operator">*</span> <span class="ruby-value">3</span>, <span class="ruby-value">align:</span> <span class="ruby-value">16</span>
<span class="ruby-keyword">end</span>
</pre>
<dl class="rdoc-list note-list"><dt>Examples
<dd>
<p>To access <code>data_p</code> field from a second <code>Sprite</code> in the <code>spritep</code>:</p>

<pre class="ruby"><span class="ruby-identifier">ld</span>  <span class="ruby-identifier">hl</span>, [<span class="ruby-identifier">spritep</span>.<span class="ruby-identifier">sprites</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">data_p</span>]
</pre>

<p>or</p>

<pre class="ruby"><span class="ruby-identifier">ld</span>  <span class="ruby-identifier">l</span>, [<span class="ruby-identifier">spritep</span>.<span class="ruby-identifier">sprites</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">data_pl</span>]
<span class="ruby-identifier">ld</span>  <span class="ruby-identifier">h</span>, [<span class="ruby-identifier">spritep</span>.<span class="ruby-identifier">sprites</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">data_ph</span>]
</pre>

<p>To set register pointing to data_p from second sprite:</p>

<pre class="ruby"><span class="ruby-identifier">ld</span>  <span class="ruby-identifier">hl</span>, <span class="ruby-identifier">spritep</span>.<span class="ruby-identifier">sprites</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">data_p</span>
<span class="ruby-identifier">ld</span>  <span class="ruby-identifier">e</span>, [<span class="ruby-identifier">hl</span>]
<span class="ruby-identifier">inc</span> <span class="ruby-identifier">hl</span>
<span class="ruby-identifier">ld</span>  <span class="ruby-identifier">d</span>, [<span class="ruby-identifier">hl</span>]
</pre>

<p>or</p>

<pre class="ruby"><span class="ruby-identifier">ld</span>  <span class="ruby-identifier">ix</span>, <span class="ruby-identifier">sprite</span>
<span class="ruby-identifier">ld</span>  <span class="ruby-identifier">b</span>, [<span class="ruby-identifier">ix</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">spritep</span>.<span class="ruby-identifier">numspr</span>]
<span class="ruby-identifier">ld</span>  <span class="ruby-identifier">l</span>, [<span class="ruby-identifier">ix</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">spritep</span>.<span class="ruby-identifier">sprites</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">data_pl</span>]
<span class="ruby-identifier">ld</span>  <span class="ruby-identifier">h</span>, [<span class="ruby-identifier">ix</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">spritep</span>.<span class="ruby-identifier">sprites</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">data_ph</span>]
</pre>

<p>Access a size of a label</p>

<pre class="ruby"><span class="ruby-identifier">ld</span>  <span class="ruby-identifier">bc</span>, <span class="ruby-operator">+</span><span class="ruby-identifier">spritep</span> <span class="ruby-comment"># lazy evaluates to +SpritePool to 13</span>
</pre>

<p>Access a size of a field</p>

<pre class="ruby"><span class="ruby-identifier">ld</span>  <span class="ruby-identifier">bc</span>, <span class="ruby-operator">+</span><span class="ruby-identifier">spritep</span>.<span class="ruby-identifier">sprites</span>       <span class="ruby-comment"># lazy evaluates to +Sprite to 6</span>
<span class="ruby-identifier">ld</span>  <span class="ruby-identifier">b</span>, <span class="ruby-operator">+</span><span class="ruby-identifier">spritep</span>.<span class="ruby-identifier">sprites</span>.<span class="ruby-identifier">size</span>   <span class="ruby-comment"># lazy evaluates to 2</span>
</pre>

<h3 id="class-Z80::Label-label-Label+names"><a href="Label.html"><code>Label</code></a> names<span><a href="#class-Z80::Label-label-Label+names">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p><a href="Label.html"><code>Label</code></a> name may be a valid ruby method name except singleton method names of your <strong>program</strong> and any existing ruby class method name:</p>
<ul><li>
<p>ruby statements</p>
</li><li>
<p>ruby core Class.methods: <code>! != !~ &lt; &lt;= &lt;=&gt; == === =~ &gt; &gt;= __id__ __send__ allocate ancestors autoload autoload? class class_eval class_exec class_variable_defined? class_variable_get class_variable_set class_variables clone const_defined? const_get const_missing const_set constants define_singleton_method display dup enum_for eql? equal? extend freeze frozen? hash include? included_modules initialize_clone initialize_dup inspect instance_eval instance_exec instance_method instance_methods instance_of? instance_variable_defined? instance_variable_get instance_variable_set instance_variables is_a? kind_of? method method_defined? methods module_eval module_exec name nil? object_id private_class_method private_instance_methods private_method_defined? private_methods protected_instance_methods protected_method_defined? protected_methods public_class_method public_instance_method public_instance_methods public_method public_method_defined? public_methods public_send remove_class_variable respond_to? respond_to_missing? send singleton_class singleton_methods superclass taint tainted? tap to_enum to_s trust untaint untrust untrusted?</code></p>
</li><li>
<p>Z80::Program.instance_methods: <code>[] a adc add addr af anda b bc bc_ bit bytes c call ccf code cp cpd cpdr cpi cpir cpl d daa data de de_ debug dec di djnz e ei ex export exx h halt hl hl_ hlt i im0 im01 im1 im2 import import_file inc ind indr ini inir inp ix ix_ ixh ixl iy iy_ iyh iyl jp jr l label labels ld ldd lddr ldi ldir macro method_missing neg new nop ns ora org otdr otir out outd outi pc pop push r reloc res ret reti retn rl rla rlc rlca rld r rra rrc rrca rrd rst sbc scf set sl1 sla sll sp sp_ sra srl sub union words xor</code></p>
</li><li>
<p>and macros defined in your <strong>program</strong>.</p>
</li></ul>
<dl class="rdoc-list note-list"><dt>Pro tip
<dd>
<p>Use namespaces: <a href="Program.html#method-i-ns"><code>Program.ns</code></a> extensively in your program.</p>
</dd></dl>

<p>Be carefull with loops, as <code>loop</code> is a ruby statement.</p>
</dd></dl>

  </section>

  <section id="5Buntitled-5D" class="documentation-section">


    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
        <dt id="Member">Member
        <dd><p>A class representing members of a data structure.</p>
      </dl>
    </section>



     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-2B-40" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">+@</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a lazy evaluated size of a data structure. Better for debugging than <a href="Label.html#method-c-to_i"><code>Label.to_i</code></a>.</p>

          <div class="method-source-code" id="2B-40-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 1057</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">+@</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@struct_size</span>)
                <span class="ruby-operator">+</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">0</span>).<span class="ruby-identifier">tap</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span><span class="ruby-identifier">l</span>.<span class="ruby-identifier">name</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span>}.<span class="ruby-identifier">to_alloc</span>)
        <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">raise</span> <span class="ruby-constant">Syntax</span>, <span class="ruby-string">&quot;Label has no size&quot;</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-byte" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">byte</span><span
            class="method-args">(size = 1)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>A data structure&#39;s field type.</p>

          <div class="method-source-code" id="byte-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 952</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">byte</span>(<span class="ruby-identifier">size</span> = <span class="ruby-value">1</span>)
        <span class="ruby-value">1</span><span class="ruby-operator">*</span><span class="ruby-identifier">size</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-dummy" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">dummy</span><span
            class="method-args">(name = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Creates a dummy label. Should not be used directly in programs. This is called by <a href="Program.html#method-i-method_missing"><code>Program.method_missing</code></a> when referenced label has not been defined yet.</p>

          <div class="method-source-code" id="dummy-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 764</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">dummy</span>(<span class="ruby-identifier">name</span> = <span class="ruby-keyword">nil</span>)
        <span class="ruby-identifier">n</span> = <span class="ruby-identifier">new</span>(<span class="ruby-value">0</span>, <span class="ruby-keyword">nil</span>)
        <span class="ruby-identifier">n</span>.<span class="ruby-identifier">name</span> = <span class="ruby-identifier">name</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span>
        <span class="ruby-identifier">n</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-members_of_struct" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">members_of_struct</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a hash containing structure members as instances of a <a href="Label.html#Member"><code>Member</code></a> class.</p>

          <div class="method-source-code" id="members_of_struct-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 1065</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">members_of_struct</span>; <span class="ruby-ivar">@members</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@members</span>]; <span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-method_missing" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">method_missing</span><span
            class="method-args">(m, struct=nil, count=1)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Any other method is being used as a label to a member of a data structure.</p>
            <div class="method-calls-super">
              Calls superclass method
              
            </div>

          <div class="method-source-code" id="method_missing-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 963</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">method_missing</span>(<span class="ruby-identifier">m</span>, <span class="ruby-identifier">struct</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">count</span>=<span class="ruby-value">1</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">struct</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@struct_size</span>) <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@members</span>)
                <span class="ruby-keyword">super</span>
        <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">n</span> = <span class="ruby-identifier">m</span>.<span class="ruby-identifier">to_s</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">struct</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Member</span>
                        <span class="ruby-identifier">struct</span>.<span class="ruby-identifier">name</span> = <span class="ruby-identifier">n</span>
                        <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;#{self.name} has already a member: #{n}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@members</span>.<span class="ruby-identifier">assoc</span>(<span class="ruby-identifier">n</span>)
                        <span class="ruby-ivar">@members</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">n</span>, <span class="ruby-identifier">struct</span>]
                        <span class="ruby-keyword">nil</span>
                <span class="ruby-keyword">else</span>
                        <span class="ruby-identifier">tsize</span> = <span class="ruby-identifier">struct</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">struct</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">struct</span>.<span class="ruby-identifier">to_i</span>
                        <span class="ruby-identifier">_</span>, <span class="ruby-identifier">mem</span> = <span class="ruby-ivar">@members</span>.<span class="ruby-identifier">assoc</span>(<span class="ruby-identifier">n</span>)
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">mem</span>
                                <span class="ruby-constant">Member</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">mem</span>.<span class="ruby-identifier">offset</span>, <span class="ruby-identifier">struct</span>, <span class="ruby-identifier">count</span>, <span class="ruby-keyword">true</span>)
                        <span class="ruby-keyword">else</span>
                                <span class="ruby-ivar">@members</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">n</span>, <span class="ruby-constant">Member</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">n</span>, <span class="ruby-ivar">@struct_size</span>, <span class="ruby-identifier">struct</span>, <span class="ruby-identifier">count</span>, <span class="ruby-keyword">false</span>)]
                                <span class="ruby-ivar">@struct_size</span><span class="ruby-operator">+=</span> <span class="ruby-identifier">tsize</span><span class="ruby-operator">*</span><span class="ruby-identifier">count</span>
                                <span class="ruby-keyword">nil</span>
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-new" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(addr, type = 1, reloc = nil, members = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Creates an instance of a label. Do not use it directly in programs. Instead use <a href="Program.html#method-i-data"><code>Program.data</code></a>, <a href="Program.html#method-i-label"><code>Program.label</code></a>, <a href="Program.html#method-i-addr"><code>Program.addr</code></a>, <a href="Program.html#method-i-union"><code>Program.union</code></a> or prepend any instruction with a name instead. Some instructions like <a href="Program.html#method-i-ns"><code>Program.ns</code></a> can create named labels if given a symbol.</p>
            <div class="method-calls-super">
              Calls superclass method
              
            </div>

          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 1070</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new</span>(<span class="ruby-identifier">addr</span>, <span class="ruby-identifier">type</span> = <span class="ruby-value">1</span>, <span class="ruby-identifier">reloc</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">members</span> = <span class="ruby-keyword">nil</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">members</span>.<span class="ruby-identifier">nil?</span>
                <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@struct_size</span>)
                        <span class="ruby-identifier">members</span> = <span class="ruby-constant">Hash</span>[<span class="ruby-ivar">@members</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
                                <span class="ruby-identifier">l</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Class</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:to_data</span>)
                                        <span class="ruby-identifier">m</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">m</span>.<span class="ruby-identifier">offset</span>, <span class="ruby-value">1</span>, <span class="ruby-value">:parent</span>)
                                <span class="ruby-keyword">else</span>
                                        <span class="ruby-constant">Label</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">m</span>.<span class="ruby-identifier">offset</span>, <span class="ruby-identifier">m</span>.<span class="ruby-identifier">type</span>, <span class="ruby-value">:parent</span>)
                                <span class="ruby-keyword">end</span>
                                <span class="ruby-identifier">l</span>.<span class="ruby-identifier">name</span> = <span class="ruby-identifier">m</span>.<span class="ruby-identifier">name</span>
                                [<span class="ruby-identifier">m</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">l</span>]
                        <span class="ruby-keyword">end</span>]
                        <span class="ruby-constant">Label</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">addr</span>, <span class="ruby-keyword">self</span>, <span class="ruby-identifier">reloc</span>, <span class="ruby-identifier">members</span>)
                <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Class</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">ancestors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-keyword">self</span>)
                        <span class="ruby-identifier">type</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">addr</span>, <span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">reloc</span>)
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span> <span class="ruby-operator">||</span> (<span class="ruby-identifier">addr</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-keyword">self</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">addr</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">super</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-offset_of_" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">offset_of_</span><span
            class="method-args">(name)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a lazy evaluated, debug visible, byte offset of a struct member. Returns <code>nil</code> if self is not a struct or a member does not exist.</p>

          <div class="method-source-code" id="offset_of_-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 1046</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">offset_of_</span>(<span class="ruby-identifier">name</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@members</span>
                <span class="ruby-identifier">name</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>
                <span class="ruby-keyword">if</span> <span class="ruby-ivar">@members</span>.<span class="ruby-identifier">any?</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">name</span> }
                        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">0</span>).<span class="ruby-identifier">tap</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span><span class="ruby-identifier">l</span>.<span class="ruby-identifier">name</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span>}.<span class="ruby-identifier">to_alloc</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">name</span>)
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-to_data" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">to_data</span><span
            class="method-args">(prog, offset, data)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Used by <a href="Program.html#method-i-data"><code>Program.data</code></a>. Do not use it directly in programs. <code>data</code> must be a <code>Hash</code>, <code>Struct</code>, <code>Array</code>, <code>String</code> or a convertible <code>Object</code> (with a <code>to_z80bin</code> method).</p>

          <div class="method-source-code" id="to_data-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 988</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_data</span>(<span class="ruby-identifier">prog</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">data</span>)
        <span class="ruby-keyword">unless</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@struct_size</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@members</span>)
                <span class="ruby-identifier">raise</span> <span class="ruby-constant">Syntax</span>, <span class="ruby-string">&quot;Label is not a data strucutre&quot;</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">data</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_h</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-operator">::</span><span class="ruby-constant">Struct</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
                <span class="ruby-identifier">res</span> = <span class="ruby-string">&quot;\x0&quot;</span><span class="ruby-operator">*</span><span class="ruby-ivar">@struct_size</span>
                <span class="ruby-ivar">@members</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span>, <span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
                        <span class="ruby-identifier">n</span> = <span class="ruby-identifier">n</span>.<span class="ruby-identifier">to_sym</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">n</span>)
                                <span class="ruby-identifier">item</span> = <span class="ruby-identifier">data</span>[<span class="ruby-identifier">n</span>]
                                <span class="ruby-identifier">items</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-operator">::</span><span class="ruby-constant">Struct</span>) <span class="ruby-keyword">then</span> [<span class="ruby-identifier">item</span>] <span class="ruby-keyword">else</span> <span class="ruby-constant">Array</span>(<span class="ruby-identifier">item</span>) <span class="ruby-keyword">end</span>
                                <span class="ruby-identifier">item_offset</span> = <span class="ruby-identifier">m</span>.<span class="ruby-identifier">offset</span>
                                <span class="ruby-identifier">m</span>.<span class="ruby-identifier">count</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
                                        <span class="ruby-identifier">s</span> = <span class="ruby-identifier">member_item_to_data</span>(<span class="ruby-identifier">prog</span>, <span class="ruby-identifier">m</span>, <span class="ruby-identifier">offset</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">item_offset</span>, <span class="ruby-identifier">items</span>[<span class="ruby-identifier">index</span>])
                                        <span class="ruby-identifier">size</span> = <span class="ruby-identifier">s</span>.<span class="ruby-identifier">bytesize</span>
                                        <span class="ruby-identifier">res</span>[<span class="ruby-identifier">item_offset</span>, <span class="ruby-identifier">size</span>] = <span class="ruby-identifier">s</span>
                                        <span class="ruby-identifier">item_offset</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">size</span>
                                <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:to_z80bin</span>
                <span class="ruby-identifier">res</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_z80bin</span>[<span class="ruby-value">0</span>,<span class="ruby-ivar">@struct_size</span>].<span class="ruby-identifier">ljust</span>(<span class="ruby-ivar">@struct_size</span>, <span class="ruby-string">&quot;\x0&quot;</span>)
        <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
                <span class="ruby-identifier">res</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-constant">Encoding</span><span class="ruby-operator">::</span><span class="ruby-constant">ASCII_8BIT</span>)[<span class="ruby-value">0</span>,<span class="ruby-ivar">@struct_size</span>].<span class="ruby-identifier">ljust</span>(<span class="ruby-ivar">@struct_size</span>, <span class="ruby-string">&quot;\x0&quot;</span>)
        <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">data</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">data</span>)
                <span class="ruby-identifier">res</span> = <span class="ruby-string">&#39;&#39;</span>
                <span class="ruby-identifier">index</span> = <span class="ruby-value">0</span>
                <span class="ruby-ivar">@members</span>.<span class="ruby-identifier">reject</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">alias</span>}.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
                        <span class="ruby-identifier">m</span>.<span class="ruby-identifier">count</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword">do</span>
                                <span class="ruby-identifier">s</span> = <span class="ruby-identifier">member_item_to_data</span>(<span class="ruby-identifier">prog</span>, <span class="ruby-identifier">m</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">data</span>[<span class="ruby-identifier">index</span>])
                                <span class="ruby-identifier">offset</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">bytesize</span>
                                <span class="ruby-identifier">index</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
                                <span class="ruby-identifier">res</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s</span>
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">res</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-to_i" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">to_i</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a size of a data structure immediately.</p>

          <div class="method-source-code" id="to_i-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 1055</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_i</span>; <span class="ruby-ivar">@struct_size</span>; <span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-to_struct" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">to_struct</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a new Ruby <code>Struct</code> from members defined in a data structure.</p>

<p>Instances of such a <code>Struct</code> are suitable for passing as arguments to <a href="Program.html#method-i-data"><code>Program.data</code></a> instead of e.g. <code>Hash</code> instances.</p>

<p><a href="Label.html#Member"><code>Member</code></a> aliases are being ignored when creating a <code>Struct</code>.</p>

          <div class="method-source-code" id="to_struct-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 947</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_struct</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">Syntax</span>, <span class="ruby-string">&quot;Label is not a data strucutre&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@members</span>)
        <span class="ruby-operator">::</span><span class="ruby-constant">Struct</span>.<span class="ruby-identifier">new</span> <span class="ruby-operator">*</span><span class="ruby-ivar">@members</span>.<span class="ruby-identifier">reject</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">alias</span>}.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">n</span>, <span class="ruby-identifier">_</span><span class="ruby-operator">|</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">to_sym</span>}
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-word" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">word</span><span
            class="method-args">(size = 1)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>A data structure&#39;s field type.</p>

          <div class="method-source-code" id="word-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 956</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">word</span>(<span class="ruby-identifier">size</span> = <span class="ruby-value">1</span>)
        <span class="ruby-value">2</span><span class="ruby-operator">*</span><span class="ruby-identifier">size</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

      <div id="method-i-25" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">%</span><span
            class="method-args">(other)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a lazy evaluated remainder of a label divided by an <code>other</code> label or an integer.</p>

          <div class="method-source-code" id="25-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 861</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">%</span>(<span class="ruby-identifier">other</span>)
        <span class="ruby-identifier">to_alloc</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">other</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-26" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">&amp;</span><span
            class="method-args">(m)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a lazy evaluated bitwise “and” of a label and an <code>other</code> label or an integer.</p>

          <div class="method-source-code" id="26-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 881</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">&amp;</span>(<span class="ruby-identifier">m</span>)
        <span class="ruby-identifier">to_alloc</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">m</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-2A" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">*</span><span
            class="method-args">(other)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a lazy evaluated label multiplied by an <code>other</code> label or an integer.</p>

          <div class="method-source-code" id="2A-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 853</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">*</span>(<span class="ruby-identifier">other</span>)
        <span class="ruby-identifier">to_alloc</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">other</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-2A-2A" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">**</span><span
            class="method-args">(name)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a member by its <code>name</code> as a separate label. This is used internally. Use <a href="Label.html#method-i-5B-5D"><code>Label#[]</code></a> and <a href="Label.html#method-i-method_missing"><code>Label#method_missing</code></a> instead.</p>

          <div class="method-source-code" id="2A-2A-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 789</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">**</span>(<span class="ruby-identifier">name</span>)
        <span class="ruby-ivar">@members</span>[<span class="ruby-identifier">name</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-2B" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">+</span><span
            class="method-args">(other)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a lazy evaluated label offset by an <code>other</code> label or an integer.</p>

          <div class="method-source-code" id="2B-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 845</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">+</span>(<span class="ruby-identifier">other</span>)
        <span class="ruby-identifier">to_alloc</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">other</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-2B-40" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">+@</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a lazy evaluated size of a type of a label.</p>

          <div class="method-source-code" id="2B-40-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 815</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">+@</span>
        <span class="ruby-operator">+</span><span class="ruby-identifier">to_alloc</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-2D" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">-</span><span
            class="method-args">(other)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a lazy evaluated label negatively offset by an <code>other</code> label or an integer.</p>

          <div class="method-source-code" id="2D-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 849</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">-</span>(<span class="ruby-identifier">other</span>)
        <span class="ruby-identifier">to_alloc</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">other</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-2D-40" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">-@</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a lazy evaluated negative label.</p>

          <div class="method-source-code" id="2D-40-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 819</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">-@</span>
        <span class="ruby-operator">-</span><span class="ruby-identifier">to_alloc</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-2F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">/</span><span
            class="method-args">(other)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a lazy evaluated quotient of a label divided by an <code>other</code> label or an integer.</p>

          <div class="method-source-code" id="2F-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 857</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">/</span>(<span class="ruby-identifier">other</span>)
        <span class="ruby-identifier">to_alloc</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">other</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-3C-3C" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">&lt;&lt;</span><span
            class="method-args">(m)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a lazy evaluated label left shifted by a number of bits as an <code>other</code> label or an integer.</p>

          <div class="method-source-code" id="3C-3C-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 869</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">&lt;&lt;</span>(<span class="ruby-identifier">m</span>)
        <span class="ruby-identifier">to_alloc</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">m</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-3E-3E" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">&gt;&gt;</span><span
            class="method-args">(m)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a lazy evaluated label right shifted by a number of bits as an <code>other</code> label or an integer.</p>

          <div class="method-source-code" id="3E-3E-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 865</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">&gt;&gt;</span>(<span class="ruby-identifier">m</span>)
        <span class="ruby-identifier">to_alloc</span> <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-identifier">m</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-5B-5D" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">[]</span><span
            class="method-args">(index = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a lazy evaluated label offset by <code>index</code>.</p>
<ul><li>
<p>If <code>index</code> is <code>nil</code>, returns a pointer label instead.</p>
</li><li>
<p>If <code>index</code> is a number or an expression the offset is multiplied by a size of a label&#39;s type.</p>
</li><li>
<p>If <code>index</code> is a symbol or a string an accessor to the member of this label will be created. See: <a href="Label.html#method-i-method_missing"><code>Label#method_missing</code></a>.</p>
</li></ul>

<p>e.g.:</p>

<pre class="ruby"><span class="ruby-identifier">foo</span> <span class="ruby-identifier">addr</span> <span class="ruby-value">0x1234</span>, <span class="ruby-value">2</span>
<span class="ruby-identifier">ld</span>  <span class="ruby-identifier">hl</span>, <span class="ruby-identifier">foo</span>[<span class="ruby-value">7</span>]   <span class="ruby-comment"># loads 0x1234+14 into hl</span>
<span class="ruby-identifier">ld</span>  <span class="ruby-identifier">hl</span>, <span class="ruby-identifier">foo</span>[<span class="ruby-value">-42</span>] <span class="ruby-comment"># loads 0x1234-84 into hl</span>
                 <span class="ruby-comment"># pointer conversion (2nd form)</span>
<span class="ruby-identifier">ld</span>  <span class="ruby-identifier">hl</span>, <span class="ruby-identifier">foo</span>[]    <span class="ruby-comment"># loads a byte from memory pointed at 0x1234 into l</span>
                 <span class="ruby-comment"># and a byte pointed at 0x1235 into h</span>
</pre>

<h5 id="method-i-5B-5D-label-For+clarity+don-27t+use+the+pointer+form+directly+in+your+programs.">For clarity don&#39;t use the pointer form directly in your programs.<span><a href="#method-i-5B-5D-label-For+clarity+don-27t+use+the+pointer+form+directly+in+your+programs.">&para;</a> <a href="#top">&uarr;</a></span></h5>

<p>Instead prefer to use one-element array wrapped around a label, integer or a Register, like this:</p>

<pre class="ruby"><span class="ruby-identifier">ld</span>  <span class="ruby-identifier">hl</span>, [<span class="ruby-identifier">foo</span>]
</pre>

          <div class="method-source-code" id="5B-5D-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 840</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">[]</span>(<span class="ruby-identifier">index</span> = <span class="ruby-keyword">nil</span>)
        <span class="ruby-identifier">to_alloc</span>[<span class="ruby-identifier">index</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-5E" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">^</span><span
            class="method-args">(m)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a lazy evaluated bitwise “exclusive or” of a label and an <code>other</code> label or an integer.</p>

          <div class="method-source-code" id="5E-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 873</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">^</span>(<span class="ruby-identifier">m</span>)
        <span class="ruby-identifier">to_alloc</span> <span class="ruby-operator">^</span> <span class="ruby-identifier">m</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-alias-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">alias?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Checks if a label is an address label (lazy alias).</p>

          <div class="method-source-code" id="alias-3F-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 760</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">alias?</span>; <span class="ruby-keyword">false</span>; <span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-dummy-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">dummy?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Checks if a label is not yet given value and type (in-the-future a.k.a. a <code>dummy</code> label).</p>

          <div class="method-source-code" id="dummy-3F-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 756</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">dummy?</span>
        <span class="ruby-ivar">@type</span>.<span class="ruby-identifier">nil?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-expression-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">expression?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Checks if a label is an expression.</p>

          <div class="method-source-code" id="expression-3F-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 744</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">expression?</span>; <span class="ruby-keyword">false</span>; <span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-immediate-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">immediate?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Checks if a label is defined and absolute: <code>true</code> or not (relative or dummy): (<code>false</code>). Prefer using <a href="Program.html#method-i-immediate-3F"><code>Program.immediate?</code></a> instead.</p>

          <div class="method-source-code" id="immediate-3F-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 748</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">immediate?</span>
        <span class="ruby-operator">!</span><span class="ruby-identifier">dummy?</span> <span class="ruby-keyword">and</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@reloc</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-indexable-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">indexable?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns <code>true</code> if a lazy evaluated label can be offset by <code>index</code>.</p>

          <div class="method-source-code" id="indexable-3F-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 823</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">indexable?</span>; <span class="ruby-keyword">true</span>; <span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-method_missing" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">method_missing</span><span
            class="method-args">(m)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Any other method will lazy evaluate as an accessor to the member label of this label.</p>
            <div class="method-calls-super">
              Calls superclass method
              
            </div>

          <div class="method-source-code" id="method_missing-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 924</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">method_missing</span>(<span class="ruby-identifier">m</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">m</span> <span class="ruby-operator">==</span> <span class="ruby-value">:to_ary</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">m</span> <span class="ruby-operator">==</span> <span class="ruby-value">:to_a</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">m</span> <span class="ruby-operator">==</span> <span class="ruby-value">:to_hash</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">m</span> <span class="ruby-operator">==</span> <span class="ruby-value">:to_h</span>
                <span class="ruby-keyword">super</span>
        <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">to_alloc</span>.<span class="ruby-identifier">send</span> <span class="ruby-identifier">m</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-name-3D" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">name=</span><span
            class="method-args">(value)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Gives a name to a no-named label. Should not be used directly in programs.</p>

          <div class="method-source-code" id="name-3D-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 895</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">name=</span>(<span class="ruby-identifier">value</span>)
        <span class="ruby-identifier">value</span> = <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">Syntax</span>, <span class="ruby-node">&quot;Invalid label name: #{value.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">Syntax</span>, <span class="ruby-node">&quot;Can&#39;t rename already named label: #{@name} != #{value}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@name</span> <span class="ruby-keyword">and</span> <span class="ruby-ivar">@name</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">value</span>
        <span class="ruby-ivar">@name</span> = <span class="ruby-identifier">value</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-pointer-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">pointer?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Checks if label is a pointer. Prefer using <a href="Program.html#method-i-pointer-3F"><code>Program.pointer?</code></a> instead.</p>

          <div class="method-source-code" id="pointer-3F-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 742</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">pointer?</span>; <span class="ruby-keyword">false</span>; <span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-sublabel-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">sublabel?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Checks if a label is a member of a struct or a stand-alone label.</p>

          <div class="method-source-code" id="sublabel-3F-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 752</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">sublabel?</span>
        <span class="ruby-ivar">@reloc</span> <span class="ruby-operator">==</span> <span class="ruby-value">:parent</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-sublabel_access_expression-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">sublabel_access_expression?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Checks if a label is a named sub-label access expression.</p>

          <div class="method-source-code" id="sublabel_access_expression-3F-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 746</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">sublabel_access_expression?</span>; <span class="ruby-keyword">false</span>; <span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-to_aliased_name" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">to_aliased_name</span><span
            class="method-args">(start)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns an abbreviated string information about a label for aliased targets.</p>

          <div class="method-source-code" id="to_aliased_name-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 913</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_aliased_name</span>(<span class="ruby-identifier">start</span>)
        <span class="ruby-keyword">return</span> <span class="ruby-ivar">@name</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@name</span>
        <span class="ruby-keyword">return</span> (<span class="ruby-ivar">@address</span> <span class="ruby-operator">+</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@reloc</span> <span class="ruby-operator">==</span> <span class="ruby-value">:code</span> <span class="ruby-keyword">then</span> <span class="ruby-identifier">start</span> <span class="ruby-keyword">else</span> <span class="ruby-value">0</span> <span class="ruby-keyword">end</span>).<span class="ruby-identifier">to_s</span>(<span class="ruby-value">16</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-to_alloc" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">to_alloc</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a lazy evaluated label as an instance of <a href="Alloc.html"><code>Alloc</code></a> class. Use one of the lazy operators directly on a label instead.</p>

          <div class="method-source-code" id="to_alloc-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 811</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_alloc</span>
        <span class="ruby-constant">Alloc</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-to_i" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">to_i</span><span
            class="method-args">(start = 0, rel_to = nil, override:nil, prefix:&#39;&#39;.freeze, size_of:false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Evaluates a label. This method is being used during program compilation.</p>
<ul><li><dl class="rdoc-list note-list"><dt><code>start</code>
<dd>
<p>An absolute address to offset a label if it&#39;s relative to the code base.</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>rel_to</code>
<dd>
<p>An absolute address to subtract from a label value or <code>:self</code> (used by ix/iy offset addressing).</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>override</code>
<dd>
<p>A Hash containing a possibly nested label names and override values for label overriding.</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>prefix</code>
<dd>
<p>A prefix of a nested label used for label overriding.</p>
</dd></dl>
</li><li><dl class="rdoc-list note-list"><dt><code>size_of</code>
<dd>
<p>If <code>true</code> returns a size of a label&#39;s type instead.</p>
</dd></dl>
</li></ul>

          <div class="method-source-code" id="to_i-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 724</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_i</span>(<span class="ruby-identifier">start</span> = <span class="ruby-value">0</span>, <span class="ruby-identifier">rel_to</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-value">override:</span><span class="ruby-keyword">nil</span>, <span class="ruby-value">prefix:</span><span class="ruby-string">&#39;&#39;</span>.<span class="ruby-identifier">freeze</span>, <span class="ruby-value">size_of:</span><span class="ruby-keyword">false</span>)
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">Syntax</span>, <span class="ruby-node">&quot;a label `#{@name}&#39; can&#39;t be coerced to a Integer before it&#39;s defined&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">dummy?</span>

        <span class="ruby-keyword">return</span> <span class="ruby-ivar">@size</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">size_of</span>

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">rel_to</span> <span class="ruby-operator">==</span> <span class="ruby-value">:self</span>
                <span class="ruby-value">0</span>
        <span class="ruby-keyword">else</span>
                <span class="ruby-keyword">if</span> <span class="ruby-ivar">@name</span>
                        <span class="ruby-identifier">fullname</span> = <span class="ruby-identifier">prefix</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@name</span>
                        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">override_value</span> = <span class="ruby-identifier">override</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">override</span>[<span class="ruby-identifier">fullname</span>])
                                <span class="ruby-keyword">return</span> <span class="ruby-identifier">override_value</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">rel_to</span>.<span class="ruby-identifier">to_i</span>
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-ivar">@address</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">rel_to</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@reloc</span> <span class="ruby-operator">==</span> <span class="ruby-value">:code</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">start</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>)
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-to_label" class="method-detail ">
        <div class="method-heading">
          <span class="method-callseq">
            to_label(program)
          </span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Should return a <a href="Label.html"><code>Label</code></a> or an <a href="Alloc.html"><code>Alloc</code></a>. This method&#39;s existence indicates that something quacks like a label. The only argument is a program class on which the label will be used.</p>

          <div class="method-source-code" id="to_label-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 893</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_label</span>(<span class="ruby-identifier">_</span>); <span class="ruby-keyword">self</span>; <span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-to_name" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">to_name</span><span
            class="method-args">(info=false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns this label&#39;s name as string or <code>nil</code>.</p>

<p><code>info</code> enables returning made up name if this label is anonymous.</p>

          <div class="method-source-code" id="to_name-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 905</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_name</span>(<span class="ruby-identifier">info</span>=<span class="ruby-keyword">false</span>)
        <span class="ruby-keyword">return</span> <span class="ruby-ivar">@name</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@name</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">info</span>
                <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;$&#39;</span>.<span class="ruby-identifier">freeze</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@reloc</span> <span class="ruby-operator">==</span> <span class="ruby-value">:code</span>
                <span class="ruby-keyword">return</span> <span class="ruby-ivar">@address</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-value">16</span>)
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-to_s" class="method-detail method-alias">
        <div class="method-heading">
          <span class="method-name">to_s</span><span
            class="method-args">()</span>
        </div>

        <div class="method-description">
          

        </div>


        <div class="aliases">
          Alias for: <a href="Label.html#method-i-to_str">to_str</a>
        </div>
      </div>

      <div id="method-i-to_str" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">to_str</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns an abbreviated string information about a label, mostly used in error messages.</p>

          <div class="method-source-code" id="to_str-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 918</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_str</span>; <span class="ruby-node">&quot;`#{@name}&#39;:#{&#39;%04X&#39; % @address}:#{@size} #{@reloc}#{dummy? ? &#39;?&#39;:&#39;&#39;}&quot;</span>; <span class="ruby-keyword">end</span></pre>
          </div>
        </div>

        <div class="aliases">
          Also aliased as: <a href="Label.html#method-i-to_s">to_s</a>
        </div>

      </div>

      <div id="method-i-7C" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">|</span><span
            class="method-args">(m)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a lazy evaluated bitwise “or” of a label and an <code>other</code> label or an integer.</p>

          <div class="method-source-code" id="7C-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 877</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">|</span>(<span class="ruby-identifier">m</span>)
        <span class="ruby-identifier">to_alloc</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">m</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-~" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">~</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a lazy evaluated bitwise negated label.</p>

          <div class="method-source-code" id="~-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 885</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">~</span>
        <span class="ruby-operator">~</span><span class="ruby-identifier">to_alloc</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

     <section id="protected-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Protected Instance Methods</h3>
       </header>

      <div id="method-i-initialize" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">initialize</span><span
            class="method-args">(address, type = 1, reloc = nil, members = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="initialize-source">
            <pre><span class="ruby-comment"># File lib/z80/labels.rb, line 770</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">address</span>, <span class="ruby-identifier">type</span> = <span class="ruby-value">1</span>, <span class="ruby-identifier">reloc</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">members</span> = <span class="ruby-keyword">nil</span>) <span class="ruby-comment"># :notnew:</span>
        <span class="ruby-comment"># an absolute or relative address</span>
        <span class="ruby-ivar">@address</span> = <span class="ruby-identifier">address</span>.<span class="ruby-identifier">to_i</span>
        <span class="ruby-comment"># size in bytes</span>
        <span class="ruby-ivar">@size</span> = <span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_i</span>
        <span class="ruby-comment"># a dummy label has @type == nil, usually 1 or 2 or a class inherited from the Label</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">and</span> (<span class="ruby-operator">!</span>(<span class="ruby-identifier">members</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">members</span>.<span class="ruby-identifier">empty?</span>) <span class="ruby-keyword">or</span> <span class="ruby-operator">!</span><span class="ruby-identifier">reloc</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">address</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>)
                <span class="ruby-identifier">raise</span> <span class="ruby-constant">Syntax</span>, <span class="ruby-node">&quot;not a really dummy label: #{self.inspect} reloc: #{reloc.inspect} address: #{address.inspect} members: #{members.inspect}&quot;</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@type</span> = <span class="ruby-identifier">type</span>
        <span class="ruby-comment"># nil, :code or :parent</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">Syntax</span>, <span class="ruby-node">&quot;reloc should be nil, :code or :parent, got: #{reloc.inspect}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">reloc</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">reloc</span> <span class="ruby-operator">==</span> <span class="ruby-value">:code</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">reloc</span> <span class="ruby-operator">==</span> <span class="ruby-value">:parent</span>
        <span class="ruby-ivar">@reloc</span> = <span class="ruby-identifier">reloc</span>
        <span class="ruby-comment"># a hash with members (struct base members have reloc == :parent)</span>
        <span class="ruby-ivar">@members</span> = {}.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">members</span> <span class="ruby-operator">||</span> {})
        <span class="ruby-comment"># optional name, assigned later</span>
        <span class="ruby-ivar">@name</span> = <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.3.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

